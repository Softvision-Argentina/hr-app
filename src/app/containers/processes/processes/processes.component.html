<div class="container">
  <br />
  <br />
  <div class="wrapper">
    <h1 class="headerFont">B.A Studio Processes</h1>
    <button nz-button nzType="primary" (click)="newProcessStart(processStart, startModalButtons)"
      class="recru-button-cta recru-button-cta--large">
      NEW CANDIDATE
    </button>
  </div>
  <br />

  <nz-tabset>
    <nz-tab nzTitle="MY PROCESSES">
      <app-processes-table [profiles]="profiles" [communities]="processesSandbox.communities$ | async"
        [listOfDisplayData]="listOfDisplayOwnData" [statusList]="statusList" [currentStageList]="currentStageList"
        [emptyProcess]="emptyProcess" (candidateId)="showCandidateDetailsModal($event, candidateDetailModal)"
        (userId)="showUserDetailsModal($event, userDetailModal)"
        (showProcessStart)="getFullProcess(processStart, startModalButtons, $event)"
        (showDeleteConfirm)="showDeleteConfirm($event)" (showApproveProcessConfirm)="showApproveProcessConfirm($event)"
        (rejectProcess)="rejectProcess($event, rejectProcessModal)">
      </app-processes-table>
    </nz-tab>

    <nz-tab nzTitle="BA STUDIO">
      <app-processes-table #processTable [profiles]="profiles" [communities]="processesSandbox.communities$ | async"
        [listOfDisplayData]="listOfDisplayData" [statusList]="statusList" [currentStageList]="currentStageList"
        [emptyProcess]="emptyProcess" (candidateId)="showCandidateDetailsModal($event, candidateDetailModal)"
        (userId)="showUserDetailsModal($event, userDetailModal)"
        (showProcessStart)="getFullProcess(processStart, startModalButtons, $event)"
        (showDeleteConfirm)="showDeleteConfirm($event)" (showApproveProcessConfirm)="showApproveProcessConfirm($event)"
        (rejectProcess)="rejectProcess($event, rejectProcessModal)">
      </app-processes-table>
    </nz-tab>

    <nz-tab nzTitle="DELETED PROCESSES" *ngIf="isUserRole(['Admin'])">
      <app-processes-table #processTable [profiles]="profiles" [communities]="processesSandbox.communities$ | async"
        [listOfDisplayData]="listOfDeletedDisplayData" [filteredProcesses]="filteredDeletedProcesses"
        [statusList]="statusList" [currentStageList]="currentStageList" [emptyProcess]="emptyProcess"
        (candidateId)="showCandidateDetailsModal($event, candidateDetailModal)"
        (userId)="showUserDetailsModal($event, userDetailModal)" (reactivateProcess)="reactivateProcess($event)">
      </app-processes-table>
    </nz-tab>
  </nz-tabset>
</div>

<ng-template #candidateDetailModal>
  <candidate-details [_detailedCandidate]="emptyCandidate"></candidate-details>
</ng-template>

<ng-template #userDetailModal>
  <user-details [_detailedUser]="emptyUser"></user-details>
</ng-template>

<ng-template #rejectProcessModal>
  <form nz-form [formGroup]="rejectProcessForm" [nzLayout]="'horizontal'">
    <nz-form-item>
      <div nz-row>
        <div nz-col nzSpan="24">
          <nz-form-label [nzSm]="9" [nzXs]="24" nzFor="type">Rejection reason</nz-form-label>
        </div>
      </div>
      <div nz-row>
        <div nz-col nzSpan="24">
          <nz-form-control [nzSm]="22" [nzXs]="24" [nzErrorTip]="rejectionReasonErrorMsg">
            <textarea rows="5" id="rejectionReasonDescription" nz-input formControlName="rejectionReasonDescription"
              placeholder="Please enter reason of rejection"></textarea>
            <ng-template #rejectionReasonErrorMsg>
              <ng-container
                *ngIf="rejectProcessForm.get('rejectionReasonDescription').dirty && rejectProcessForm.get('rejectionReasonDescription').errors">
                Please specify why the process is rejected
              </ng-container>
            </ng-template>
          </nz-form-control>
        </div>
      </div>
    </nz-form-item>
  </form>
</ng-template>

<ng-template #processStart>
  <div nz-col nzSpan="24">
    <nz-steps nzLabelPlacement="vertical" [nzCurrent]="stepIndex">
      <nz-step nzTitle="HR" id="candidateButton" (click)="onHrStageSlideClick($event.currentTarget.id)">
      </nz-step>
      <nz-step nzTitle="Technical" id="technicalButton" (click)="onTechnicalStageSlideClick($event.currentTarget.id)">
      </nz-step>
      <nz-step *ngIf="isUserRole(['Admin','Recruiter'])" nzTitle="Client" id="clientButton"
        (click)="onClientStageSlideClick($event.currentTarget.id)"></nz-step>
      <nz-step *ngIf="isUserRole(['Admin','Recruiter'])" nzTitle="Pre-Offer" id="preOfferButton"
        (click)="onPreOfferStageSlideClick($event.currentTarget.id)"></nz-step>
      <nz-step *ngIf="isUserRole(['Admin','Recruiter'])" nzTitle="Offer" id="offerButton"
        (click)="onOfferStageSlideClick($event.currentTarget.id)"></nz-step>
    </nz-steps>
  </div>
  <ngx-slick-carousel #slickModal='slick-carousel' class="carousel" [config]="slideConfig" (destroy)="closeModal()">
    <div ngxSlickItem>
      <candidate-add [_profiles]="profiles" [_communities]="processesSandbox.communities$ | async"
        [_process]="emptyProcess" [_users]="users" [_candidate]="currentCandidate" [_offices]="processesSandbox.offices$ | async">
      </candidate-add>
      <hr-stage [_users]="users" [readdressReasonTypeList]="processesSandbox.readdressReasonTypes$ | async"
        [readdressReasonList]="processesSandbox.readdressReasons$ | async" [hrStage]="emptyProcess.hrStage"></hr-stage>
    </div>
    <div ngxSlickItem>
      <technical-stage [_process]="emptyProcess" [_users]="users" [readdressReasonTypeList]="processesSandbox.readdressReasonTypes$ | async"
        [readdressReasonList]="processesSandbox.readdressReasons$ | async" [technicalStage]="emptyProcess.technicalStage"
        (selectedSeniority)="updateSeniority($event)"></technical-stage>
    </div>
    <div ngxSlickItem>
      <client-stage [_users]="users" [clientStage]="emptyProcess.clientStage"
        [readdressReasonTypeList]="processesSandbox.readdressReasonTypes$ | async" [readdressReasonList]="processesSandbox.readdressReasons$ | async"
        [processSaveEvent]="processesSandbox.currentProcessId$"></client-stage>
    </div>
    <div ngxSlickItem>
      <pre-offer-stage [_users]="users" [processes]="processesSandbox.processes$ | async"
        [preOfferStage]="emptyProcess.preOfferStage" [readdressReasonTypeList]="processesSandbox.readdressReasonTypes$ | async"
        [readdressReasonList]="processesSandbox.readdressReasons$ | async" [processId]="processId"
        (selectedSeniority)="updateSeniority($event)"></pre-offer-stage>
    </div>
    <div ngxSlickItem>
      <offer-stage [_users]="users" [offerStage]="emptyProcess.offerStage" [preOfferData]="preOfferData"
        (selectedSeniority)="updateSeniority($event)"></offer-stage>
    </div>
  </ngx-slick-carousel>
</ng-template>

<ng-template #startModalButtons>
  <nz-divider class="custom-divider"></nz-divider>
  <div nz-row nzJustify="center">
    <div nz-col nzSpan="24">
      <button nz-button nzType="default" (click)="clearDataAndCloseModal()">Cancel</button>
      <button nz-button nzType="primary" (click)="saveProcess()">
        Save
        <nz-spin *ngIf="this.processesSandbox.isLoading$ | async" nzSimple style="display: inline-block!important;"
          [nzIndicator]="indicatorTemplate" [nzSize]="'small'">
        </nz-spin>
      </button>
    </div>
    <div nz-col>
      <p class="recru-caption">
        (*) Mandatory fields
      </p>
    </div>
  </div>
</ng-template>

<!-- <ng-template #searchContactedCandidate>
  <app-process-contact [_candidateProfiles]=profiles [_communities]=communities [_processModal]=processStart
    [_processFooterModal]=startModalButtons></app-process-contact>
</ng-template> -->


<ng-template #indicatorTemplate><i nz-icon nzType="loading" style="font-size: 24px;color:white"></i> </ng-template>