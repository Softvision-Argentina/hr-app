<form nz-form [formGroup]="preOfferForm" [nzLayout]="'horizontal'" class="recru-container">
    <nz-divider nzText="PRE OFFER STAGE"></nz-divider>
    <nz-form-item hidden>
        <nz-form-control>
            <input type="hidden" formControlName="id">
        </nz-form-control>
    </nz-form-item>


    <div class="recru-row">
        <nz-form-item>
            <nz-form-control [nzErrorTip]="statusErrorMsg">
                <nz-select *recruInput="'Status'" formControlName="status" (ngModelChange)="statusChanged()">
                    <nz-option *ngFor="let status of statusList" nzLabel="{{status.name}}" [nzValue]="status.id">
                    </nz-option>
                </nz-select>
                <ng-template #statusErrorMsg>
                    <ng-container *ngIf="preOfferForm.get('status').dirty && preOfferForm.get('status').errors">
                        Please select a status
                    </ng-container>
                </ng-template>
            </nz-form-control>
        </nz-form-item>
    </div>

    <div class="recru-row" *ngIf="CanShowReaddressPossibility()">
        <nz-form-item class="recru-col-2 ">
            <nz-form-control>
                <nz-select *recruInput="'Reason'" formControlName="reasonSelectControl"
                    nzPlaceHolder="Select rejection reason" (ngModelChange)="getSelectedReason($event)">
                    <nz-option *ngFor="let reason of readdressFilteredList" nzLabel="{{reason.name}}"
                        nzValue="{{reason.id}}">
                    </nz-option>
                </nz-select>
            </nz-form-control>
        </nz-form-item>

        <nz-form-item class="recru-col-2 ">
            <nz-form-control>
                <input *recruInput="'Reason explanation'" nz-input formControlName="reasonDescriptionTextAreaControl"
                    (input)="onDescriptionChange($event.target.value)">
            </nz-form-control>
        </nz-form-item>
    </div>

    <div class="recru-row">
        <nz-form-item class="recru-col-2 ">
            <nz-form-control [nzErrorTip]="dniErrorMsg">
                <input *recruInput="'DNI'" id="dni" formControlName="dni" (keyup)="checkLength($event.target)"
                    maxlength="8" type="number" nz-input>
                <ng-template #dniErrorMsg>
                    <ng-container *ngIf="preOfferForm.get('dni').dirty && preOfferForm.get('dni').errors">
                        <ng-container *ngIf="preOfferForm.get('dni').hasError('dniTooShortError')">
                            DNI is too short
                        </ng-container>
                        <ng-container *ngIf="preOfferForm.get('dni').hasError('emptyInputError')">
                            DNI is empty
                        </ng-container>
                        <ng-container *ngIf="preOfferForm.get('dni').hasError('dniFirstDigitError')">
                            DNI shouldn't be 0
                        </ng-container>
                        <ng-container *ngIf="preOfferForm.get('dni').hasError('dniExists')">
                            The Dni already exists
                        </ng-container>
                    </ng-container>
                </ng-template>
            </nz-form-control>
        </nz-form-item>

        <nz-form-item class="recru-col-2 ">
            <nz-form-control [nzErrorTip]="dateOfBirthErrorMsg">
                <nz-date-picker *recruInput="'Birth Date'" style="width: 100%;" formControlName="date" [nzDisabledDate]="disabledBirthDates"></nz-date-picker>
                <ng-template #dateOfBirthErrorMsg>
                    <ng-container *ngIf="preOfferForm.get('date').dirty && preOfferForm.get('date').errors">
                        Please input a date
                    </ng-container>
                </ng-template>
            </nz-form-control>
        </nz-form-item>
    </div>


    <div class="recru-row" formGroupName="backgroundCheck">
        <nz-form-item class="recru-col-2 ">
            <nz-form-control>
                <nz-select *recruInput="'Background Check'" formControlName="done" nzPlaceHolder="Select an option" (ngModelChange)="cleanDate('backgroundCheck')">
                    <nz-option nzLabel="N/A" [nzValue]="checkedEnum.NA"></nz-option>
                    <nz-option nzLabel="Rejected" [nzValue]="checkedEnum.Rejected"></nz-option>
                    <nz-option nzLabel="Accepted" [nzValue]="checkedEnum.Accepted"></nz-option>
                </nz-select>
            </nz-form-control>
        </nz-form-item>

        <nz-form-item class="recru-col-2 ">
            <nz-form-control [nzValidateStatus]="preOfferForm.controls['backgroundCheck']" [nzErrorTip]="backgroundCheckDoneDateErrorMsg">
                <nz-date-picker *recruInput="'Done Date'" style="width: 100%;"
                    formControlName="date"></nz-date-picker>
                <ng-template #backgroundCheckDoneDateErrorMsg>
                    <ng-container
                        *ngIf="preOfferForm.get('backgroundCheck').errors">
                        Please input a date
                    </ng-container>
                </ng-template>
            </nz-form-control>
        </nz-form-item>
    </div>

    <div class="recru-row" formGroupName="preocupational">
        <nz-form-item class="recru-col-2 ">
            <nz-form-control>
                <nz-select *recruInput="'Medical Check'" formControlName="done" nzPlaceHolder="Select an option" (ngModelChange)="cleanDate('preocupational')">
                    <nz-option nzLabel="N/A" [nzValue]="checkedEnum.NA"></nz-option>
                    <nz-option nzLabel="Rejected" [nzValue]="checkedEnum.Rejected"></nz-option>
                    <nz-option nzLabel="Accepted" [nzValue]="checkedEnum.Accepted"></nz-option>
                </nz-select>
            </nz-form-control>
        </nz-form-item>

        <nz-form-item class="recru-col-2 ">
            <nz-form-control [nzValidateStatus]="preOfferForm.controls['preocupational']" [nzErrorTip]="preocupationalDoneDateErrorMsg">
                <nz-date-picker *recruInput="'Done Date'" style="width: 100%;" formControlName="date">
                </nz-date-picker>
                <ng-template #preocupationalDoneDateErrorMsg>
                    <ng-container
                        *ngIf="preOfferForm.get('preocupational').errors">
                        Please input a date
                    </ng-container>
                </ng-template>
            </nz-form-control>
        </nz-form-item>
    </div>

    <div class="recru-row" *ngIf="preOfferStage">
        <pre-offer-history [preOfferStatus]="preOfferForm.get('status').value" [_processId]=preOfferStage.processId
            keyboard="false"></pre-offer-history>
    </div>
</form>